# ä½¿ç”¨ mask-image è®©é™æ€å›¾ç‰‡åŠ¨èµ·æ¥ ğŸ’¢

![banner.gif](./assets/images/banner.gif)

> å£°æ˜ï¼šæœ¬æ–‡æ¶‰åŠå›¾æ–‡å’Œæ¨¡å‹ç´ æä»…ç”¨äºä¸ªäººå­¦ä¹ ã€ç ”ç©¶å’Œæ¬£èµï¼Œè¯·å‹¿äºŒæ¬¡ä¿®æ”¹ã€éæ³•ä¼ æ’­ã€è½¬è½½ã€å‡ºç‰ˆã€å•†ç”¨ã€åŠè¿›è¡Œå…¶ä»–è·åˆ©è¡Œä¸ºã€‚

## èƒŒæ™¯

å¦‚ `ğŸ‘†` `Banner` å›¾è²‚è‰ `çŒ«å½±å¹»èˆ` çš®è‚¤æ‰€ç¤ºï¼Œå¦‚æœä½ æœ‰ç©è¿‡ `ã€Šç‹è€…è£è€€ã€‹` ã€ `ã€Šé˜´é˜³å¸ˆã€‹` ç­‰æ‰‹æ¸¸ï¼Œä¸€å®šæœ‰æ³¨æ„åˆ°è¿‡ï¼Œå®ƒçš„å¯åŠ¨åŠ¨ç”»ã€çš®è‚¤å¡ç‰‡ç«‹ç»˜ç­‰ï¼Œç»å¸¸çœ‹èµ·æ¥æ˜¯ä¸€å¼ é™æ€çš„å›¾ç‰‡ï¼Œä½†æ˜¯å±€éƒ¨æœ‰**æ¶²æ€æµåŠ¨åŠ¨ç”»**æ•ˆæœï¼Œå¦‚æµåŠ¨çš„æ°´æµã€é£˜åŠ¨çš„é›¾æ°”ã€é£ã€è¡£ç‰©ç­‰ã€‚æœ¬æ–‡ä½¿ç”¨å‰ç«¯å¼€å‘æŠ€æœ¯ï¼Œæ¥å®ç°ç±»ä¼¼çš„æ¶²åŒ–æµåŠ¨æ•ˆæœã€‚

## æ•ˆæœ

> `ğŸ®` åœ¨çº¿ä½“éªŒï¼š<https://dragonir.github.io/paint-heat-map/>

ä¸‹é¢å‡ å¼ å›¾æ˜¯ä½¿ç”¨æœ¬æ–‡å†…å®¹ç”Ÿæˆçš„æµåŠ¨æ•ˆæœï¼Œgifå›¾å‹ç¼©æ¯”è¾ƒä¸¥é‡æ•ˆæœä¸å¤ªå¥½ï¼Œå¤§å®¶å¯ä»¥æ‰“å¼€ç¤ºä¾‹é“¾æ¥ï¼Œäº²è‡ªä¸Šä¼ å›¾ç‰‡ä½“éªŒæ•ˆæœã€‚

ğŸŒ… æ¹–é¢æ³¢åŠ¨

![sample_0](./assets/images/sample_0.gif)

ğŸ¨ æ–‡å­—æ¶²åŒ–

![sample_1](./assets/images/sample_1.gif)

ğŸ”¥ å²©æµ†æ²¸è…¾

![sample_2](./assets/images/sample_2.gif)

> `ğŸ“Œ` psï¼šä½“éªŒé¡µé¢éƒ¨ç½²åœ¨Gitpageæ–‡ä¸­ä¸Šä¼ å›¾ç‰‡åŠŸèƒ½ä¸æ˜¯çœŸæ­£ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œè€Œæ˜¯åªä¼šåŠ è½½åˆ°æµè§ˆå™¨æœ¬åœ°ï¼Œé¡µé¢ä¸ä¼šè·å–ä»»ä½•ä¿¡æ¯ï¼Œå¤§å®¶å¯ä»¥æ”¾å¿ƒä½“éªŒï¼Œä¸ç”¨æ‹…å¿ƒéšç§æ³„æ¼é—®é¢˜ã€‚

## åŸç†

### mask-image

`mask-image` `CSS` å±æ€§ç”¨äºè®¾ç½®å…ƒç´ ä¸Šé®ç½©å±‚çš„å›¾åƒã€‚

* åˆå§‹å€¼ï¼š`none`
* é€‚ç”¨å…ƒç´ ï¼šæ‰€æœ‰å…ƒç´ ï¼Œåœ¨ `SVG` ä¸­å®ƒç”Ÿæ•ˆäºé™¤äº† `defs` å…ƒç´ å’Œæ‰€æœ‰å›¾å½¢å…ƒç´ ä»¥å¤–çš„æ‰€æœ‰å®¹å™¨å…ƒç´ 
* æ˜¯å¦æ˜¯ç»§æ‰¿å±æ€§ï¼šå¦
* è®¡ç®—å€¼ï¼šæŒ‰ç…§æŒ‡å®šï¼Œä½† `url` å€¼è®¾ä¸ºç»å¯¹å€¼
* åŠ¨ç”»ç±»å‹ï¼šç¦»æ•£å‹

#### è¯­æ³•

```css
/* é»˜è®¤å€¼ï¼Œé€æ˜çš„é»‘è‰²å›¾åƒå±‚ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é®ç½©å±‚ã€‚ */
mask-image: none;
/* <mask-source><mask>æˆ–CSSå›¾åƒçš„urlçš„å€¼ */
mask-image: url(masks.svg#mask1);
/* <image> å›¾ç‰‡ä½œä¸ºé®ç½©å±‚ */
mask-image: linear-gradient(rgba(0, 0, 0, 1.0), transparent);
mask-image: image(url(mask.png), skyblue);
/* å¤šä¸ªå€¼ */
mask-image: image(url(mask.png), skyblue), linear-gradient(rgba(0, 0, 0, 1.0), transparent);
/* å…¨å±€å€¼ */
mask-image: inherit;
mask-image: initial;
mask-image: unset;
```

![caniuse](./assets/images/caniuse.png)

#### ä¾‹å­

```css
#masked {
  width: 100px;
  height: 100px;
  background-color: #8cffa0;
  mask-image: url(https://mdn.mozillademos.org/files/12676/star.svg);
  -webkit-mask-image: url(https://mdn.mozillademos.org/files/12676/star.svg);
}
```

```html
<div id="masked"></div>
```

> `âš¡` æ­¤åŠŸèƒ½æŸäº›æµè§ˆå™¨å°šåœ¨å¼€å‘ä¸­ï¼Œéœ€è¦ä½¿ç”¨æµè§ˆå™¨å‰ç¼€ä»¥å…¼å®¹ä¸åŒæµè§ˆå™¨ã€‚

## å®ç°

é¡µé¢ä¸»è¦ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼Œé¡¶éƒ¨ç”¨äºåŠ è½½å›¾ç‰‡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æŒ‰ä½é¼ æ ‡ç»˜åˆ¶çš„æ–¹å¼ç»™å›¾ç‰‡æ·»åŠ æµåŠ¨æ•ˆæœï¼›åº•éƒ¨æ˜¯æ§åˆ¶åŒºåŸŸï¼Œç‚¹å‡»æŒ‰é’® `ğŸ”˜` **æ¸…é™¤ç”»å¸ƒ**ï¼Œå¯ä»¥æ¸…é™¤ç»˜åˆ¶çš„æµåŠ¨åŠ¨ç”»æ•ˆæœã€ç‚¹å‡»æŒ‰é’® `ğŸ”˜` **åˆ‡æ¢å›¾ç‰‡**å¯ä»¥åŠ è½½æœ¬åœ°çš„å›¾ç‰‡ã€‚`âš ` æ³¨æ„ï¼Œè¿˜æœ‰ä¸€ä¸ªéšå½¢çš„åŠŸèƒ½ï¼Œå½“ä½ ç»˜åˆ¶å®Œæˆæ—¶ï¼Œå¯ä»¥ç‚¹å‡» `ğŸ–±` é¼ æ ‡å³é”®ï¼Œç„¶åé€‰æ‹©ä¿å­˜å›¾ç‰‡ï¼Œä¿å­˜çš„è¿™å¼ å›¾ç‰‡å°±æ˜¯æˆ‘ä»¬ç»˜åˆ¶æµä½“åŠ¨ç”»è·¯å¾„çš„çƒ­ç‚¹å›¾ï¼Œåˆ©ç”¨è¿™å¼ çƒ­ç‚¹å›¾ï¼Œä½¿ç”¨æœ¬æ–‡çš„ `CSS` çŸ¥è¯†ï¼Œå°±èƒ½æŠŠé™æ€å›¾ç‰‡è½¬åŒ–æˆåŠ¨æ€å›¾å•¦ï¼

![step_0](./assets/images/step_0.png)

### é¡µé¢

feTurbulence
è¯¥æ»¤é•œåˆ©ç”¨ Perlin å™ªå£°å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªå›¾åƒã€‚å®ƒå®ç°äº†äººé€ çº¹ç†æ¯”å¦‚è¯´äº‘çº¹ã€å¤§ç†çŸ³çº¹çš„åˆæˆã€‚

feDisplacementMap
æ˜ å°„ç½®æ¢æ»¤é•œï¼Œè¯¥æ»¤é•œç”¨æ¥è‡ªå›¾åƒä¸­ä»in2åˆ°ç©ºé—´çš„åƒç´ å€¼ç½®æ¢å›¾åƒä»inåˆ°ç©ºé—´çš„åƒç´ å€¼ã€‚

```html
<main id="sketch">
  <canvas id="canvas" data-img=""></canvas>
  <div class="mask">
    <div id="maskInner" class="mask-inner"></div>
  </div>
</main>
<section class="button_container">
  <button class="button">æ¸…é™¤ç”»å¸ƒ</button>
  <button class="button"><input class="input" type="file" id="upload">ä¸Šä¼ å›¾ç‰‡</button>
</section>
<svg xlmns="http://www.w3.org/2000/svg" version="1.1">
  <filter id="heat" filterUnits="objectBoundingBox" x="0" y="0" width="100%" height="100%">
    <feTurbulence id="heatturb" type="fractalNoise" numOctaves="1" seed="2" />
    <feDisplacementMap xChannelSelector="G" yChannelSelector="B" scale="22" in="SourceGraphic" />
  </filter>
</svg>
```

### ç»˜åˆ¶

```js
var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
var sketch = document.getElementById('sketch');
var sketchStyle = window.getComputedStyle(sketch);
var mouse = { x: 0, y: 0 };

canvas.width = parseInt(sketchStyle.getPropertyValue('width'));
canvas.height = parseInt(sketchStyle.getPropertyValue('height'));

canvas.addEventListener('mousemove', e => {
  mouse.x = e.pageX - canvas.getBoundingClientRect().left;
  mouse.y = e.pageY - canvas.getBoundingClientRect().top;
}, false);

ctx.lineWidth = 40;
ctx.lineJoin = 'round';
ctx.lineCap = 'round';
ctx.strokeStyle = 'black';

canvas.addEventListener('mousedown', () => {
  ctx.beginPath();
  ctx.moveTo(mouse.x, mouse.y);
  canvas.addEventListener('mousemove', onPaint, false);
}, false);

canvas.addEventListener('mouseup', () => {
  canvas.removeEventListener('mousemove', onPaint, false);
}, false);

var onPaint = () => {
  ctx.lineTo(mouse.x, mouse.y);
  ctx.stroke();
  var url = canvas.toDataURL();
  document.querySelectorAll('div').forEach(item => {
    item.style.cssText += `
      display: initial;
      -webkit-mask-image: url(${url});
      mask-image: url(${url});
    `;
  });
};

document.querySelectorAll('div').forEach(item => {
  item.style.cssText += `
    display: initial;
  `;
});

var timeline = new TimelineMax({
  repeat: -1,
  yoyo: true
}),
feTurb = document.querySelector('#heatturb');

timeline.add(
  new TweenMax.to(feTurb, 8, {
    onUpdate: function () {
      var bfX = this.progress() * 0.01 + 0.025,
        bfY = this.progress() * 0.003 + 0.01,
        bfStr = bfX.toString() + ' ' + bfY.toString();
      feTurb.setAttribute('baseFrequency', bfStr);
    }
  }),
0);


function clear() {
  document.querySelectorAll('div').forEach(item => {
    item.style.cssText += `
      display: none;
      -webkit-mask-image: none;
      mask-image: none;
    `;
  });
}

document.querySelectorAll('.button').forEach(item => {
  item.addEventListener('click', () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    clear();
  })
});

document.getElementById('upload').onchange = function () {
  var imageFile = this.files[0];
  var newImg = window.URL.createObjectURL(imageFile);
  clear();
  document.getElementById('sketch').style.cssText += `
    background: url(${newImg});
    background-size: cover;
    background-position: center;
  `;
  document.getElementById('maskInner').style.cssText += `
    background: url(${newImg});
    background-size: cover;
    background-position: center;
  `;
};
```

é€šè¿‡ä¿®æ”¹svgçš„å±æ€§ï¼Œå®ç°åŠ¨ç”»æ•ˆæœ

### æ ·å¼

```css
main {
  cursor: -webkit-grab;
  cursor: grab;
  width: 960px;
  height: 540px;
  flex-shrink: 0;
  background-image: url('../images/bg.jpg');
  background-size: cover;
  background-position: 100% 50%;
  position: relative;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 1px 1px 10px rgba(0, 0, 0, .5);
  border: 1px groove rgba(255, 255, 255, .2);
}
canvas {
  opacity: 0;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
.mask {
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  mask-mode: luminance;
  -webkit-mask-size: 100% 100%;
          mask-size: 100% 100%;
  -webkit-backdrop-filter: hard-light;
          backdrop-filter: hard-light;
  -webkit-mask-image: url('../images/mask.png');
  mask-image: url('../images/mask.png');
}
.mask-inner {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url('../images/bg.jpg') 0% 0% repeat;
  background-size: cover;
  background-position: 100% 50%;
  filter: url(#heat);
  -webkit-mask-image: url('../images/mask.png');
  mask-image: url('../images/mask.png')
}
```

åœ¨é¡µé¢å³é”®ä¿å­˜ç”Ÿæˆçš„çƒ­ç‚¹å›¾

![mask](./assets/images/mask.png)

![banner.gif](./assets/images/banner.gif)

## é™„å½•

* [æˆ‘çš„3Dä¸“æ å¯ä»¥ç‚¹å‡»æ­¤é“¾æ¥è®¿é—® ğŸ‘ˆ](https://juejin.cn/column/7049923956257587213)
* [1]. [ğŸ¦Š Three.js å®ç°3Då¼€æ”¾ä¸–ç•Œå°æ¸¸æˆï¼šé˜¿ç‹¸çš„å¤šå…ƒå®‡å®™](https://juejin.cn/post/7081429595689320478)
* [2]. [ğŸ”¥ Three.js ç«ç„°æ•ˆæœå®ç°è‰¾å°”ç™»æ³•ç¯åŠ¨æ€logo](https://juejin.cn/post/7077726955528781832)
* [3]. [ğŸ¼ Three.js å®ç°2022å†¬å¥¥ä¸»é¢˜3Dè¶£å‘³é¡µé¢ï¼Œå«å†°å¢©å¢©](https://juejin.cn/post/7060292943608807460)
* `...`

* [1]. [ğŸ“· å‰ç«¯å®ç°å¾ˆå“‡å¡çš„æµè§ˆå™¨ç«¯æ‰«ç åŠŸèƒ½](https://juejin.cn/post/7018722520345870350)
* [2]. [ğŸŒ å‰ç«¯ç“¦ç‰‡åœ°å›¾åŠ è½½ä¹‹å¡å°”è¾¾ä¼ è¯´æ—·é‡ä¹‹æ¯](https://juejin.cn/post/7007432493569671182)
* [3]. [ğŸ˜± ä»…ç”¨CSSå‡ æ­¥å®ç°èµ›åšæœ‹å…‹2077é£æ ¼è§†è§‰æ•ˆæœ](https://juejin.cn/post/6972759988632551460)
* `...`

## å‚è€ƒ

* [1]. [https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/feDisplacementMap](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/feDisplacementMap)
