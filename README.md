# ä½¿ç”¨ mask-image ç»™é™æ€å›¾ç‰‡æ·»åŠ åŠ¨æ€æ•ˆæœ

![banner.gif](./assets/images/banner.gif)

> å£°æ˜ï¼šæœ¬æ–‡æ¶‰åŠå›¾æ–‡å’Œæ¨¡å‹ç´ æä»…ç”¨äºä¸ªäººå­¦ä¹ ã€ç ”ç©¶å’Œæ¬£èµï¼Œè¯·å‹¿äºŒæ¬¡ä¿®æ”¹ã€éæ³•ä¼ æ’­ã€è½¬è½½ã€å‡ºç‰ˆã€å•†ç”¨ã€åŠè¿›è¡Œå…¶ä»–è·åˆ©è¡Œä¸ºã€‚

## èƒŒæ™¯

å¦‚Bannerå›¾è²‚è‰çš®è‚¤æ‰€ç¤ºï¼Œå¦‚æœä½ æœ‰ç©è¿‡ã€Šç‹è€…è£è€€ã€‹ã€ã€Šé˜´é˜³å¸ˆã€‹ç­‰æ‰‹æ¸¸ï¼Œä¸€å®šæœ‰æ³¨æ„åˆ°è¿‡ï¼Œå®ƒçš„å¯åŠ¨åŠ¨ç”»ã€çš®è‚¤å¡ç‰‡ç«‹ç»˜ç­‰ï¼Œç»å¸¸çœ‹èµ·æ¥æ˜¯ä¸€å¼ é™æ€çš„å›¾ç‰‡ï¼Œä½†æ˜¯å±€éƒ¨æœ‰æ¶²æ€æµåŠ¨åŠ¨ç”»æ•ˆæœï¼Œå¦‚æµåŠ¨çš„æ°´æµã€é£˜åŠ¨çš„é›¾æ°”ã€é£ã€è¡£ç‰©ç­‰ã€‚æœ¬æ–‡ä½¿ç”¨å‰ç«¯å¼€å‘æŠ€æœ¯ï¼Œæ¥å®ç°ç±»ä¼¼çš„æ¶²åŒ–æµåŠ¨æ•ˆæœã€‚

## æ•ˆæœ

ä¸‹é¢å‡ å¼ å›¾æ˜¯ä½¿ç”¨æœ¬æ–‡å†…å®¹ç”Ÿæˆçš„æµåŠ¨æ•ˆæœï¼Œgifå›¾å‹ç¼©æ¯”è¾ƒä¸¥é‡æ•ˆæœä¸å¤ªå¥½ï¼Œå¤§å®¶å¯ä»¥æ‰“å¼€ç¤ºä¾‹é“¾æ¥ï¼Œäº²è‡ªä¸Šä¼ å›¾ç‰‡ä½“éªŒæ•ˆæœã€‚ï¼ˆpsï¼šä½“éªŒé¡µé¢éƒ¨ç½²åœ¨Gitpageæ–‡ä¸­ä¸Šä¼ å›¾ç‰‡åŠŸèƒ½ä¸æ˜¯çœŸæ­£ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œè€Œæ˜¯åªä¼šåŠ è½½åˆ°æµè§ˆå™¨æœ¬åœ°ï¼Œé¡µé¢ä¸ä¼šè·å–ä»»ä½•ä¿¡æ¯ï¼Œå¤§å®¶å¯ä»¥æ”¾å¿ƒä½“éªŒï¼Œä¸ç”¨æ‹…å¿ƒéšç§æ³„æ¼é—®é¢˜ï¼‰

æ¹–é¢æ³¢åŠ¨

![sample_0](./assets/images/sample_0.gif)

æ–‡å­—æ¶²åŒ–

![sample_1](./assets/images/sample_1.gif)

å²©æµ†æ²¸è…¾

![sample_2](./assets/images/sample_2.gif)

> `ğŸ®` åœ¨çº¿ä½“éªŒï¼š<https://dragonir.github.io/paint-heat-map/>

## åŸç†

### mask-image

`mask-image` `CSS` å±æ€§ç”¨äºè®¾ç½®å…ƒç´ ä¸Šé®ç½©å±‚çš„å›¾åƒã€‚

* åˆå§‹å€¼ï¼š`none`
* é€‚ç”¨å…ƒç´ ï¼šæ‰€æœ‰å…ƒç´ ï¼Œåœ¨ `SVG` ä¸­å®ƒç”Ÿæ•ˆäºé™¤äº† `defs` å…ƒç´ å’Œæ‰€æœ‰å›¾å½¢å…ƒç´ ä»¥å¤–çš„æ‰€æœ‰å®¹å™¨å…ƒç´ 
* æ˜¯å¦æ˜¯ç»§æ‰¿å±æ€§ï¼šå¦
* è®¡ç®—å€¼ï¼šæŒ‰ç…§æŒ‡å®šï¼Œä½† `url` å€¼è®¾ä¸ºç»å¯¹å€¼
* åŠ¨ç”»ç±»å‹ï¼šç¦»æ•£å‹

#### è¯­æ³•

```css
/* é»˜è®¤å€¼ï¼Œé€æ˜çš„é»‘è‰²å›¾åƒå±‚ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é®ç½©å±‚ã€‚ */
mask-image: none;
/* <mask-source><mask>æˆ–CSSå›¾åƒçš„urlçš„å€¼ */
mask-image: url(masks.svg#mask1);
/* <image> å›¾ç‰‡ä½œä¸ºé®ç½©å±‚ */
mask-image: linear-gradient(rgba(0, 0, 0, 1.0), transparent);
mask-image: image(url(mask.png), skyblue);
/* å¤šä¸ªå€¼ */
mask-image: image(url(mask.png), skyblue), linear-gradient(rgba(0, 0, 0, 1.0), transparent);
/* å…¨å±€å€¼ */
mask-image: inherit;
mask-image: initial;
mask-image: unset;
```

![caniuse](./assets/images/caniuse.png)

#### ä¾‹å­

```css
#masked {
  width: 100px;
  height: 100px;
  background-color: #8cffa0;
  mask-image: url(https://mdn.mozillademos.org/files/12676/star.svg);
  -webkit-mask-image: url(https://mdn.mozillademos.org/files/12676/star.svg);
}
```

```html
<div id="masked"></div>
```

> `âš¡` æ­¤åŠŸèƒ½æŸäº›æµè§ˆå™¨å°šåœ¨å¼€å‘ä¸­ï¼Œéœ€è¦ä½¿ç”¨æµè§ˆå™¨å‰ç¼€ä»¥å…¼å®¹ä¸åŒæµè§ˆå™¨ã€‚

## å®ç°

é¡µé¢ä¸»è¦ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼Œé¡¶éƒ¨ç”¨äºåŠ è½½å›¾ç‰‡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æŒ‰ä½é¼ æ ‡ç»˜åˆ¶çš„æ–¹å¼ç»™å›¾ç‰‡æ·»åŠ æµåŠ¨æ•ˆæœï¼›åº•éƒ¨æ˜¯æ§åˆ¶åŒºåŸŸï¼Œç‚¹å‡» `æ¸…é™¤ç”»å¸ƒ` æŒ‰é’®ï¼Œå¯ä»¥æ¸…é™¤ç»˜åˆ¶çš„æµåŠ¨åŠ¨ç”»æ•ˆæœã€ç‚¹å‡» `åˆ‡æ¢å›¾ç‰‡` å¯ä»¥åŠ è½½æœ¬åœ°çš„å›¾ç‰‡ã€‚`âš âš âš ` æ³¨æ„ï¼Œè¿˜æœ‰ä¸€ä¸ªéšå½¢çš„åŠŸèƒ½ï¼Œå½“ä½ ç»˜åˆ¶å®Œæˆæ—¶ï¼Œå¯ä»¥ç‚¹å‡»ğŸ–±é¼ æ ‡å³é”®ï¼Œç„¶åé€‰æ‹©ä¿å­˜å›¾ç‰‡ï¼Œä¿å­˜çš„è¿™å¼ å›¾ç‰‡å°±æ˜¯æˆ‘ä»¬ç»˜åˆ¶æµä½“åŠ¨ç”»è·¯å¾„çš„çƒ­ç‚¹å›¾ï¼Œåˆ©ç”¨è¿™å¼ çƒ­ç‚¹å›¾ï¼Œä½¿ç”¨æœ¬æ–‡çš„CSSçŸ¥è¯†ï¼Œå°±èƒ½æŠŠé™æ€å›¾ç‰‡è½¬åŒ–æˆåŠ¨æ€å›¾å•¦ï¼

![step_0](./assets/images/step_0.png)

### é¡µé¢

feTurbulence
è¯¥æ»¤é•œåˆ©ç”¨ Perlin å™ªå£°å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªå›¾åƒã€‚å®ƒå®ç°äº†äººé€ çº¹ç†æ¯”å¦‚è¯´äº‘çº¹ã€å¤§ç†çŸ³çº¹çš„åˆæˆã€‚

feDisplacementMap
æ˜ å°„ç½®æ¢æ»¤é•œï¼Œè¯¥æ»¤é•œç”¨æ¥è‡ªå›¾åƒä¸­ä»in2 (en-US)åˆ°ç©ºé—´çš„åƒç´ å€¼ç½®æ¢å›¾åƒä»inåˆ°ç©ºé—´çš„åƒç´ å€¼ã€‚

```html
<main id="sketch">
  <canvas id="canvas" data-img=""></canvas>
  <div class="mask">
    <div id="maskInner" class="mask-inner"></div>
  </div>
</main>
<section class="button_container">
  <button class="button">æ¸…é™¤ç”»å¸ƒ</button>
  <button class="button"><input class="input" type="file" id="upload">ä¸Šä¼ å›¾ç‰‡</button>
</section>
<svg xlmns="http://www.w3.org/2000/svg" version="1.1">
  <filter id="heat" filterUnits="objectBoundingBox" x="0" y="0" width="100%" height="100%">
    <feTurbulence id="heatturb" type="fractalNoise" numOctaves="1" seed="2" />
    <feDisplacementMap xChannelSelector="G" yChannelSelector="B" scale="22" in="SourceGraphic" />
  </filter>
</svg>
```

### ç»˜åˆ¶

```js
var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
var sketch = document.getElementById('sketch');
var sketchStyle = window.getComputedStyle(sketch);
var mouse = { x: 0, y: 0 };

canvas.width = parseInt(sketchStyle.getPropertyValue('width'));
canvas.height = parseInt(sketchStyle.getPropertyValue('height'));

canvas.addEventListener('mousemove', e => {
  mouse.x = e.pageX - canvas.getBoundingClientRect().left;
  mouse.y = e.pageY - canvas.getBoundingClientRect().top;
}, false);

ctx.lineWidth = 40;
ctx.lineJoin = 'round';
ctx.lineCap = 'round';
ctx.strokeStyle = 'black';

canvas.addEventListener('mousedown', () => {
  ctx.beginPath();
  ctx.moveTo(mouse.x, mouse.y);
  canvas.addEventListener('mousemove', onPaint, false);
}, false);

canvas.addEventListener('mouseup', () => {
  canvas.removeEventListener('mousemove', onPaint, false);
}, false);

var onPaint = () => {
  ctx.lineTo(mouse.x, mouse.y);
  ctx.stroke();
  var url = canvas.toDataURL();
  document.querySelectorAll('div').forEach(item => {
    item.style.cssText += `
      display: initial;
      -webkit-mask-image: url(${url});
      mask-image: url(${url});
    `;
  });
};

document.querySelectorAll('div').forEach(item => {
  item.style.cssText += `
    display: initial;
  `;
});

var timeline = new TimelineMax({
  repeat: -1,
  yoyo: true
}),
feTurb = document.querySelector('#heatturb');

timeline.add(
  new TweenMax.to(feTurb, 8, {
    onUpdate: function () {
      var bfX = this.progress() * 0.01 + 0.025,
        bfY = this.progress() * 0.003 + 0.01,
        bfStr = bfX.toString() + ' ' + bfY.toString();
      feTurb.setAttribute('baseFrequency', bfStr);
    }
  }),
0);


function clear() {
  document.querySelectorAll('div').forEach(item => {
    item.style.cssText += `
      display: none;
      -webkit-mask-image: none;
      mask-image: none;
    `;
  });
}

document.querySelectorAll('.button').forEach(item => {
  item.addEventListener('click', () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    clear();
  })
});

document.getElementById('upload').onchange = function () {
  var imageFile = this.files[0];
  var newImg = window.URL.createObjectURL(imageFile);
  clear();
  document.getElementById('sketch').style.cssText += `
    background: url(${newImg});
    background-size: cover;
    background-position: center;
  `;
  document.getElementById('maskInner').style.cssText += `
    background: url(${newImg});
    background-size: cover;
    background-position: center;
  `;
};
```

### æ ·å¼

```css
main {
  cursor: -webkit-grab;
  cursor: grab;
  width: 960px;
  height: 540px;
  flex-shrink: 0;
  background-image: url('../images/bg.jpg');
  background-size: cover;
  background-position: 100% 50%;
  position: relative;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 1px 1px 10px rgba(0, 0, 0, .5);
  border: 1px groove rgba(255, 255, 255, .2);
}
canvas {
  opacity: 0;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
.mask {
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  mask-mode: luminance;
  -webkit-mask-size: 100% 100%;
          mask-size: 100% 100%;
  -webkit-backdrop-filter: hard-light;
          backdrop-filter: hard-light;
  -webkit-mask-image: url('../images/mask.png');
  mask-image: url('../images/mask.png');
}
.mask-inner {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url('../images/bg.jpg') 0% 0% repeat;
  background-size: cover;
  background-position: 100% 50%;
  filter: url(#heat);
  -webkit-mask-image: url('../images/mask.png');
  mask-image: url('../images/mask.png')
}
```

## æ›´å¤šç¤ºä¾‹

### example 0

Say you had an element with a photographic background, and a black-and-white SVG graphic to use as a mask, like this:

![image_0](https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/image-and-mask.png?resize=1000%2C857&ssl=1)

You could set the image as a background-image and the mask as a mask-image on the same element, and get something like this:

```html
<div class="el"></div>
```

```css
body {
  margin: 0;
  background: #a8ff78;
  background: -webkit-linear-gradient(to right, #78ffd6, #a8ff78);
  background: linear-gradient(to right, #78ffd6, #a8ff78);
}
.el {
  width: 100vw;
  height: 100vh;
  padding: 1rem;
  background-image: url('../assets/images/bg.jpg');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  -webkit-mask-image: url('../assets/images/sun.svg');
  -webkit-mask-size: 100vmin;
  -webkit-mask-repeat: no-repeat;
  -webkit-mask-position: center;
  mask-image: url('../assets/images/sun.svg');
  mask-size: 100vmin;
  mask-repeat: no-repeat;
  mask-position: center;
}
```

![example_0](./assets/images/example_0.png)

That works because the top of the linear-gradient is transparent. I would have assumed it would work if it was white as well as long as the mask-type was luminance, but that doesnâ€™t seem to work in any browser for me.

Speaking of luminance masks, that doesnâ€™t seem to work for images-as-masks that are a raster format like JPG or PNG for me. Update: Reader Micheal Hall writes in with a demo where it might have something to do with using the long-hand properties. Firefox seems to support this concept if you only use the shorthand.

But alpha masks seem to work just fine. As in raster graphics that use actual alpha transparency. Like this:

#### example 1

![dragonir](./assets/images/dragonir.png)

```html
<div class="el"></div>
```

```css
body {
  margin: 0;
  background: #f08c0a;
  background: -webkit-linear-gradient(to right, #03c03c, #f08c0a);
  background: linear-gradient(to right, #03c03c, #f08c0a);
  background-position-x: 0;
  animation: size 2s infinite ease-in-out;
}
@keyframes size {
  to {
    background-position-x: 100vw;
  }
}
.el {
  width: 100vw;
  height: 100vh;
  background-image: url('../assets/images/bg.jpg');
  background-size: cover;
  background-position: center;
  -webkit-mask-image: url('../assets/images/dragonir.png');
  -webkit-mask-size: cover;
  mask-image: url('../assets/images/dragonir.png');
  mask-size: cover;
}
```

![example_0](./assets/images/example_1.gif)

#### example 2

The mask-image property can also be used directly inside SVG elements. Like check out this elliptical mask that also has a blurred filter:

```html
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="170" height="200">
  <defs>
    <filter id="filter">
      <feGaussianBlur stdDeviation="5" />
    </filter>
    <mask id="mask">
      <ellipse cx="50%" cy="50%" rx="25%" ry="25%" fill="white" filter="url(#filter)"></ellipse>
    </mask>
  </defs>
  <image xlink:href="https://s3-us-west-2.amazonaws.com/s.cdpn.io/3/Harry-Potter-1-.jpg" width="170" height="200" mask="url(#mask)"></image>
</svg>
```

It kinda looks like you could snag that SVG mask and apply it to other elements with mask-image: url(#mask); but I donâ€™t find that actually works. It only works within SVG, and has a nasty side effect of entirely erasing an image if used outside the SVG.

![example_0](./assets/images/example_2.png)

We covered the use of the clip-path property for clipping using CSS, so itâ€™s only natural that we now go over masking. Contrary to clipping, where a part of an image or element is either completely invisible or completely visible, with masking we can hide or show parts of an image with different levels of opacity.

Masking in CSS is done using the mask-image property, and an image has to be provided as the mask. Anything thatâ€™s 100% black in the image mask with be completely visible, anything thatâ€™s 100% transparent will be completely hidden, and anything in-between will partially mask the image. Linear and radial gradients in CSS are generated images, so they can be used as the image mask. SVGs that use the mask element can also be used as the image mask. Letâ€™s go over the 3 possibilities for image masks with concrete examples:

Masking Using Gradients
Letâ€™s first use a simple linear gradient that goes from transparent to black. The first image is our default starting image, and the second image has our linear gradient applied as the mask-image value:

![example_0](./assets/images/example_3.png)

Hereâ€™s the CSS rules used here:

```css
.mask1 {
  -webkit-mask-image: linear-gradient(to bottom, transparent 25%, black 75%);
  mask-image: linear-gradient(to bottom, transparent 25%, black 75%);
}
```

Here are two more examples of interesting effects that can be accomplished with masking using gradients:

![example_0](./assets/images/example_4.png)

And the CSS rules for these 2 gradient masks:

```css
.mask2 {
  -webkit-mask-image: radial-gradient(circle at 50% 60%, black 50%, rgba(0, 0, 0, 0.6) 50%);
  mask-image: radial-gradient(circle at 50% 60%, black 50%, rgba(0, 0, 0, 0.6) 50%);
}
.mask3 {
  -webkit-mask-image: radial-gradient(ellipse 90% 80% at 48% 78%, black 40%, transparent 50%);
  mask-image: radial-gradient(ellipse 90% 80% at 48% 78%, black 40%, transparent 50%);
}
```

##### Masking Using Images

Hereâ€™s weâ€™re using an image that was created using Sketch as our image mask. The first image is the image mask itself, and the second image has that mask applied to it:

![example_0](./assets/images/example_5.png)

And our CSS looks like this:

```css
.mask4 {
  -webkit-mask-image: url("/path/to/image-mask.png");
  mask-image: url("/path/to/image-mask.png");
  -webkit-mask-size: 400px 600px;
  mask-size: 400px 600px;
}
```

We specified a value for mask-size here because our image mask is 800px by 1200px, but here we want everything shrunk by half so that the image can look sharp on retina displays.

##### Masking Using SVG Masks

Finally, if SVG is your groove, you can define image masks using the SVG mask element.

The first example currently only seems to be working in Firefox (you probably wonâ€™t see anything in non-supporting browsers). It defines the SVG mask and then we reference the ID of the mask in CSS as usual. The second example seems to have wider support and defines the image as part of the SVG element itself.

> Also note that with SVG masks, the colors to use are white and black instead of transparent and black. The colors also work in reverse and white/partially white is what will be visible.

![example_0](./assets/images/example_6.png)

Example 1 (triangle)
Hereâ€™s the SVG markup for the first example:

```html
<svg width="0" height="0" viewBox="0 0 400 600">
  <defs>
    <mask id="my-svg-mask">
      <rect fill="#000000" x="0" y="0" width="400" height="600"></rect>
      <polygon fill="#FFFFFF" points="200.5 152 349 449 52 449"></polygon>
    </mask>
  </defs>
</svg>
```

Then we can apply the mask to our image with mask-image as usual by refecencing the ID of the SVG mask:

```css
.mask5 {
  -webkit-mask-image: url(#my-svg-mask);
  mask-image: url(#my-svg-mask);
}
```

Example 2 (bubbles)
For our second SVG example, everything is contained in the SVG definition, including our main image itself:

```html
<svg width="400px" height="600px" viewBox="0 0 400 600">
  <defs>
    <mask id="my-svg-mask2">
      <rect id="Rectangle" fill="#000000" x="0" y="0" width="400" height="600"></rect>
      <circle id="Oval" fill="#FFFFFF" cx="67.5" cy="51.5" r="67.5"></circle>
      <circle id="Oval" fill="#FFFFFF" cx="296.597656" cy="118.597656" r="56.5976562"></circle>
      <circle id="Oval" fill="#FFFFFF" cx="53.4648437" cy="256.464844" r="81.4648437"></circle>
      <circle id="Oval" fill="#FFFFFF" cx="239.587891" cy="313.587891" r="70.5878906"></circle>
      <circle id="Oval" fill="#FFFFFF" cx="366.597656" cy="562.597656" r="56.5976562"></circle>
      <circle id="Oval" fill="#FFFFFF" cx="93.203125" cy="486.203125" r="76.203125"></circle>
    </mask>
  </defs>
  <image mask="url(#my-svg-mask2)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/css/masking/masking-example1.jpg" width="400" height="600"></image>
</svg>
```

## å‚è€ƒèµ„æ–™

* [1]. <https://developer.mozilla.org/zh-CN/docs/Web/CSS/mask-image>
* [2]. <https://css-tricks.com/almanac/properties/m/mask-image/>
* [3]. <https://www.digitalocean.com/community/tutorials/css-masking-with-mask-image>
https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/feDisplacementMap
